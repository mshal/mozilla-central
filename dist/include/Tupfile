# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this file,
# You can obtain one at http://mozilla.org/MPL/2.0/.

include_rules

# Process all of the idl files in dist/idl so we can generate headers.
: foreach ../idl/*.idl | ../idl/<installed-idls> |> ^ python header.py [%f -> %o]^ $(PYHEADER) -I../idl %f -o %o --cachedir=../idl |> %B.h <installed-headers>

# List of directories that contain EXPORTS
EXPORT_DIRS += $(MOZ_ROOT)/accessible/public/ia2
EXPORT_DIRS += $(MOZ_ROOT)/accessible/public
EXPORT_DIRS += $(MOZ_ROOT)/accessible/public/msaa
EXPORT_DIRS += $(MOZ_ROOT)/accessible/src/atk
EXPORT_DIRS += $(MOZ_ROOT)/accessible/src/base
EXPORT_DIRS += $(MOZ_ROOT)/accessible/src/mac
EXPORT_DIRS += $(MOZ_ROOT)/accessible/src/msaa
EXPORT_DIRS += $(MOZ_ROOT)/accessible/src/other
EXPORT_DIRS += $(MOZ_ROOT)/accessible/src/windows/ia2
EXPORT_DIRS += $(MOZ_ROOT)/browser/components/build
EXPORT_DIRS += $(MOZ_ROOT)/caps/include
EXPORT_DIRS += $(MOZ_ROOT)/content/base/public
EXPORT_DIRS += $(MOZ_ROOT)/content/base/src
EXPORT_DIRS += $(MOZ_ROOT)/content/canvas/public
EXPORT_DIRS += $(MOZ_ROOT)/content/events/public
EXPORT_DIRS += $(MOZ_ROOT)/content/events/src
EXPORT_DIRS += $(MOZ_ROOT)/content/html/content/public
EXPORT_DIRS += $(MOZ_ROOT)/content/html/content/src
EXPORT_DIRS += $(MOZ_ROOT)/content/html/document/src
EXPORT_DIRS += $(MOZ_ROOT)/content/mathml/content/src
EXPORT_DIRS += $(MOZ_ROOT)/content/media/dash
EXPORT_DIRS += $(MOZ_ROOT)/content/media/gstreamer
EXPORT_DIRS += $(MOZ_ROOT)/content/media
EXPORT_DIRS += $(MOZ_ROOT)/content/media/ogg
EXPORT_DIRS += $(MOZ_ROOT)/content/media/omx
EXPORT_DIRS += $(MOZ_ROOT)/content/media/plugins
EXPORT_DIRS += $(MOZ_ROOT)/content/media/raw
EXPORT_DIRS += $(MOZ_ROOT)/content/media/wave
EXPORT_DIRS += $(MOZ_ROOT)/content/media/webm
EXPORT_DIRS += $(MOZ_ROOT)/content/media/webrtc
EXPORT_DIRS += $(MOZ_ROOT)/content/smil
EXPORT_DIRS += $(MOZ_ROOT)/content/svg/content/src
EXPORT_DIRS += $(MOZ_ROOT)/content/xbl/src
EXPORT_DIRS += $(MOZ_ROOT)/content/xml/document/public
EXPORT_DIRS += $(MOZ_ROOT)/content/xslt/public
EXPORT_DIRS += $(MOZ_ROOT)/content/xul/document/public
EXPORT_DIRS += $(MOZ_ROOT)/dbm/include
EXPORT_DIRS += $(MOZ_ROOT)/db/sqlite3/src
EXPORT_DIRS += $(MOZ_ROOT)/docshell/base
EXPORT_DIRS += $(MOZ_ROOT)/docshell/build
EXPORT_DIRS += $(MOZ_ROOT)/docshell/shistory/src
EXPORT_DIRS += $(MOZ_ROOT)/dom/audiochannel
EXPORT_DIRS += $(MOZ_ROOT)/dom/base
EXPORT_DIRS += $(MOZ_ROOT)/dom/browser-element
EXPORT_DIRS += $(MOZ_ROOT)/dom/camera
EXPORT_DIRS += $(MOZ_ROOT)/dom/devicestorage
EXPORT_DIRS += $(MOZ_ROOT)/dom/file
EXPORT_DIRS += $(MOZ_ROOT)/dom/interfaces/storage
EXPORT_DIRS += $(MOZ_ROOT)/dom/ipc
EXPORT_DIRS += $(MOZ_ROOT)/dom/plugins/base/android
EXPORT_DIRS += $(MOZ_ROOT)/dom/plugins/base
EXPORT_DIRS += $(MOZ_ROOT)/dom/src/geolocation
EXPORT_DIRS += $(MOZ_ROOT)/dom/src/json
EXPORT_DIRS += $(MOZ_ROOT)/dom/src/jsurl
EXPORT_DIRS += $(MOZ_ROOT)/dom/system/gonk
EXPORT_DIRS += $(MOZ_ROOT)/dom/system
EXPORT_DIRS += $(MOZ_ROOT)/editor/public
EXPORT_DIRS += $(MOZ_ROOT)/editor/txmgr/public
EXPORT_DIRS += $(MOZ_ROOT)/editor/txtsvc/public
EXPORT_DIRS += $(MOZ_ROOT)/embedding/browser/webBrowser
EXPORT_DIRS += $(MOZ_ROOT)/embedding/components/appstartup/src
EXPORT_DIRS += $(MOZ_ROOT)/embedding/components/windowwatcher/public
EXPORT_DIRS += $(MOZ_ROOT)/gfx/cairo/libpixman/src
EXPORT_DIRS += $(MOZ_ROOT)/gfx/gl
EXPORT_DIRS += $(MOZ_ROOT)/gfx/layers
EXPORT_DIRS += $(MOZ_ROOT)/gfx/ots/src
EXPORT_DIRS += $(MOZ_ROOT)/gfx/qcms
EXPORT_DIRS += $(MOZ_ROOT)/gfx/src
EXPORT_DIRS += $(MOZ_ROOT)/gfx/thebes
EXPORT_DIRS += $(MOZ_ROOT)/gfx/ycbcr
EXPORT_DIRS += $(MOZ_ROOT)/image/public
EXPORT_DIRS += $(MOZ_ROOT)/image/src
EXPORT_DIRS += $(MOZ_ROOT)/intl/chardet/public
EXPORT_DIRS += $(MOZ_ROOT)/intl/hyphenation/public
EXPORT_DIRS += $(MOZ_ROOT)/intl/locale/public
EXPORT_DIRS += $(MOZ_ROOT)/intl/locale/src
EXPORT_DIRS += $(MOZ_ROOT)/intl/lwbrk/public
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/public
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/ucvcn
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/ucvibm
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/ucvja
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/ucvko
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/ucvlatin
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/ucvtw2
EXPORT_DIRS += $(MOZ_ROOT)/intl/uconv/ucvtw
EXPORT_DIRS += $(MOZ_ROOT)/intl/unicharutil/public
EXPORT_DIRS += $(MOZ_ROOT)/intl/unicharutil/util
EXPORT_DIRS += $(MOZ_ROOT)/ipc/glue
EXPORT_DIRS += $(MOZ_ROOT)/js/jsd
EXPORT_DIRS += $(MOZ_ROOT)/js/src/config
EXPORT_DIRS += $(MOZ_ROOT)/js/src
EXPORT_DIRS += $(MOZ_ROOT)/js/xpconnect/public
EXPORT_DIRS += $(MOZ_ROOT)/js/xpconnect/src
EXPORT_DIRS += $(MOZ_ROOT)/layout/base
EXPORT_DIRS += $(MOZ_ROOT)/layout/build
EXPORT_DIRS += $(MOZ_ROOT)/layout/forms
EXPORT_DIRS += $(MOZ_ROOT)/layout/generic
EXPORT_DIRS += $(MOZ_ROOT)/layout/inspector/src
EXPORT_DIRS += $(MOZ_ROOT)/layout/style
EXPORT_DIRS += $(MOZ_ROOT)/layout/svg
EXPORT_DIRS += $(MOZ_ROOT)/layout/tables
EXPORT_DIRS += $(MOZ_ROOT)/layout/tools/layout-debug/src
EXPORT_DIRS += $(MOZ_ROOT)/layout/xul/base/public
EXPORT_DIRS += $(MOZ_ROOT)/layout/xul/base/src/grid
EXPORT_DIRS += $(MOZ_ROOT)/layout/xul/base/src/tree/public
EXPORT_DIRS += $(MOZ_ROOT)/layout/xul/base/src/tree/src
EXPORT_DIRS += $(MOZ_ROOT)/media/libjpeg
EXPORT_DIRS += $(MOZ_ROOT)/media/libpng
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/common_video/vplib/main/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/audio_conference_mixer/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/media_file/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/rtp_rtcp/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/udp_transport/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/utility/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/video_capture/main/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/video_coding/codecs/i420/main/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/video_coding/codecs/vp8/main/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/video_coding/main/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/modules/video_processing/main/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/system_wrappers/source
EXPORT_DIRS += $(MOZ_ROOT)/media/webrtc/trunk/src/video_engine/main/source
EXPORT_DIRS += $(MOZ_ROOT)/memory/mozjemalloc
EXPORT_DIRS += $(MOZ_ROOT)/mobile/android/components/build
EXPORT_DIRS += $(MOZ_ROOT)/mobile/xul/components/build
EXPORT_DIRS += $(MOZ_ROOT)/modules/libbz2/src
EXPORT_DIRS += $(MOZ_ROOT)/modules/libjar
EXPORT_DIRS += $(MOZ_ROOT)/modules/libmar/src
EXPORT_DIRS += $(MOZ_ROOT)/modules/zlib/src
EXPORT_DIRS += $(MOZ_ROOT)/mozglue/android
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/base/public
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/base/src
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/build
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/cache
EXPORT_DIRS += $(MOZ_ROOT)/netwerk
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/mime
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/protocol/about
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/protocol/ftp
EXPORT_DIRS += $(MOZ_ROOT)/netwerk/protocol/http
EXPORT_DIRS += $(MOZ_ROOT)/nsprpub/config
EXPORT_DIRS += $(MOZ_ROOT)/other-licenses/skia-npapi
EXPORT_DIRS += $(MOZ_ROOT)/parser/expat/lib
EXPORT_DIRS += $(MOZ_ROOT)/parser/expat
EXPORT_DIRS += $(MOZ_ROOT)/parser/html
EXPORT_DIRS += $(MOZ_ROOT)/parser/htmlparser/public
EXPORT_DIRS += $(MOZ_ROOT)/parser
EXPORT_DIRS += $(MOZ_ROOT)/parser/xml/src
EXPORT_DIRS += $(MOZ_ROOT)/profile/dirserviceprovider/public
EXPORT_DIRS += $(MOZ_ROOT)/rdf/base/public
EXPORT_DIRS += $(MOZ_ROOT)/rdf/build
EXPORT_DIRS += $(MOZ_ROOT)/rdf/datasource/public
EXPORT_DIRS += $(MOZ_ROOT)/rdf/util/public
EXPORT_DIRS += $(MOZ_ROOT)/security/manager/ssl/src
EXPORT_DIRS += $(MOZ_ROOT)/storage/build
EXPORT_DIRS += $(MOZ_ROOT)/storage/public
EXPORT_DIRS += $(MOZ_ROOT)/toolkit/components/alerts/mac
EXPORT_DIRS += $(MOZ_ROOT)/toolkit/components/build
EXPORT_DIRS += $(MOZ_ROOT)/toolkit/components/mediasniffer
EXPORT_DIRS += $(MOZ_ROOT)/toolkit/crashreporter
EXPORT_DIRS += $(MOZ_ROOT)/toolkit/mozapps/update/common
EXPORT_DIRS += $(MOZ_ROOT)/toolkit/xre
EXPORT_DIRS += $(MOZ_ROOT)/tools/dmdv
EXPORT_DIRS += $(MOZ_ROOT)/tools/jprof/stub
EXPORT_DIRS += $(MOZ_ROOT)/tools/profiler
EXPORT_DIRS += $(MOZ_ROOT)/tools/trace-malloc/lib
EXPORT_DIRS += $(MOZ_ROOT)/uriloader/base
EXPORT_DIRS += $(MOZ_ROOT)/uriloader/exthandler
EXPORT_DIRS += $(MOZ_ROOT)/uriloader/prefetch
EXPORT_DIRS += $(MOZ_ROOT)/view/public
EXPORT_DIRS += $(MOZ_ROOT)/widget/android
EXPORT_DIRS += $(MOZ_ROOT)/widget/cocoa
EXPORT_DIRS += $(MOZ_ROOT)/widget/gonk
EXPORT_DIRS += $(MOZ_ROOT)/widget/gtk2
EXPORT_DIRS += $(MOZ_ROOT)/widget/gtkxtbin
EXPORT_DIRS += $(MOZ_ROOT)/widget
EXPORT_DIRS += $(MOZ_ROOT)/widget/qt
EXPORT_DIRS += $(MOZ_ROOT)/widget/windows
EXPORT_DIRS += $(MOZ_ROOT)/widget/xpwidgets
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/base
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/build
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/components
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/ds
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/glue
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/io
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/reflect/xptcall/public
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/reflect/xptinfo/public
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/string/public
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/threads
EXPORT_DIRS += $(MOZ_ROOT)/xpcom/typelib/xpt/public
EXPORT_DIRS += $(MOZ_ROOT)/xpfe/appshell/public

# Allow pymake to support $(shell) by giving it the SHELL environment variable.
export SHELL

run $(PYTHON) $(MOZ_ROOT)/build/pymake/tup_export.py EXPORTS $(MOZ_ROOT) @(MOZ_OBJDIR) $(EXPORT_DIRS)

# These dirs specify SDK_HEADERS, which are really just EXPORTS
SDK_HEADER_DIRS += $(MOZ_ROOT)/embedding/base
SDK_HEADER_DIRS += $(MOZ_ROOT)/intl/unicharutil/util
SDK_HEADER_DIRS += $(MOZ_ROOT)/xpcom
SDK_HEADER_DIRS += $(MOZ_ROOT)/xpcom/base
SDK_HEADER_DIRS += $(MOZ_ROOT)/xpcom/build
SDK_HEADER_DIRS += $(MOZ_ROOT)/xpcom/glue
SDK_HEADER_DIRS += $(MOZ_ROOT)/xpcom/glue/standalone
SDK_HEADER_DIRS += $(MOZ_ROOT)/xpcom/io
SDK_HEADER_DIRS += $(MOZ_ROOT)/xpcom/string/public

run $(PYTHON) $(MOZ_ROOT)/build/pymake/tup_export.py SDK_HEADERS $(MOZ_ROOT) @(MOZ_OBJDIR) $(SDK_HEADER_DIRS)

# NSS dirs run a little differently, since they use manifest.mn instead of Makefile.in
# as the primary source of info.
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/bltest
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/chktest
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/crmf-cgi
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/crmftest
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/fipstest
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/lowhashtest
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/modutil
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/pk11mode
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/rsapoptst
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/signtool
NSS_DIRS += $(MOZ_ROOT)/security/nss/cmd/ssltap
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/base
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/certdb
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/certhigh
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/ckfw
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/ckfw/builtins
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/ckfw/capi
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/ckfw/nssmkey
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/crmf
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/cryptohi
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/dev
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/freebl
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/jar
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/include
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/certsel
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/checker
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/crlsel
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/params
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix_pl_nss/module
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix_pl_nss/pki
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix_pl_nss/system
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/results
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/store
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/top
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/libpkix/pkix/util
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/nss
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/pk11wrap
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/pkcs12
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/pkcs7
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/pki
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/smime
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/softoken
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/sqlite
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/ssl
NSS_DIRS += $(MOZ_ROOT)/security/nss/lib/util
NSS_DIRS += $(MOZ_ROOT)/security/nss/tests/pkcs11/netscape/suites/security/ssl

run $(PYTHON) $(MOZ_ROOT)/build/pymake/tup_export.py --allow-includes -m Makefile EXPORTS $(MOZ_ROOT) @(MOZ_OBJDIR) $(NSS_DIRS)

# Copy some extra headers from one-off directories that don't use EXPORTS, or wildcard *.h
INSTALL_ALL_HEADERS += $(MOZ_ROOT)/nsprpub/lib/ds/*.h
INSTALL_ALL_HEADERS += $(MOZ_ROOT)/nsprpub/lib/libc/include/*.h
INSTALL_ALL_HEADERS += $(MOZ_ROOT)/nsprpub/pr/include/*.h
INSTALL_ALL_HEADERS += $(MOZ_ROOT)/config/nsStaticComponents.h
INSTALL_ALL_HEADERS += $(MOZ_ROOT)/js/xpconnect/src/DictionaryHelpers.h

: foreach $(INSTALL_ALL_HEADERS) |> !ln |> %b <installed-headers>

: $(MOZ_ROOT)/nsprpub/pr/include/md/@(MDCPUCFG_H) |> !ln |> prcpucfg.h <installed-headers>
